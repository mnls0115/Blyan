<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Join the Network - Blyan</title>
    <link rel="icon" href="/favicon.png" type="image/png">
    <link rel="shortcut icon" href="/favicon.png" type="image/png">
    <link rel="stylesheet" href="components.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="common-header-themed.css">
    <link rel="stylesheet" href="page-template.css">
    <script src="language.js"></script>
    <script src="wallet.js"></script>
    <script src="theme.js?v=2"></script>
    <style>
        /* Theme variables */
        :root {
            --color-primary: #1E3A8A;
            --color-primary-light: #2E4EAE;
            --color-primary-dark: #152C66;
            --color-secondary: #06B6D4;
            --color-secondary-light: #22D3EE;
            --color-secondary-dark: #0891B2;
            --color-background: #FFFFFF;
            --color-surface: #F9FAFB;
            --color-elevated: #FFFFFF;
            --color-text-primary: #111827;
            --color-text-secondary: #374151;
            --color-text-disabled: #9CA3AF;
            --color-divider: #E5E7EB;
            --color-action-hover: rgba(30, 58, 138, 0.08);
            --color-action-selected: rgba(30, 58, 138, 0.12);
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.06);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 16px 32px rgba(0, 0, 0, 0.12);
        }
        
        [data-theme="dark"] {
            --color-primary: #22D3EE;
            --color-primary-light: #67E8F9;
            --color-primary-dark: #06B6D4;
            --color-secondary: #2E4EAE;
            --color-secondary-light: #4361C2;
            --color-secondary-dark: #1E3A8A;
            --color-background: #111827;
            --color-surface: #1F2937;
            --color-elevated: #0F172A;
            --color-text-primary: #F9FAFB;
            --color-text-secondary: #D1D5DB;
            --color-text-disabled: #4B5563;
            --color-divider: #374151;
            --color-action-hover: rgba(6, 182, 212, 0.12);
            --color-action-selected: rgba(6, 182, 212, 0.16);
            --shadow-sm: 0 2px 4px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.3);
            --shadow-lg: 0 8px 16px rgba(0, 0, 0, 0.4);
            --shadow-xl: 0 16px 32px rgba(0, 0, 0, 0.5);
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--color-text-primary);
            background-color: var(--color-background);
            transition: background-color 0.3s ease, color 0.3s ease;
            margin: 0;
        }

        /* Requirements Grid */
        .requirements-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 24px;
            margin-top: 40px;
        }

        .requirement-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px;
            background: linear-gradient(145deg, var(--color-surface), var(--color-elevated));
            border-radius: 12px;
            border: 1px solid var(--color-divider);
            position: relative;
            transition: all 0.3s ease;
        }
        
        .requirement-item::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--color-primary), var(--color-secondary));
            border-radius: 12px 12px 0 0;
        }
        
        .requirement-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--color-primary);
        }

        .requirement-icon {
            font-size: 24px;
        }

        .requirement-text {
            flex: 1;
        }

        .requirement-label {
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: 4px;
        }

        .requirement-value {
            color: var(--color-text-secondary);
            font-size: 0.9rem;
        }

        /* Setup Steps */
        .setup-steps {
            counter-reset: step-counter;
            margin-top: 40px;
        }

        .setup-step {
            position: relative;
            padding: 24px;
            padding-left: 60px;
            margin-bottom: 24px;
            background: linear-gradient(145deg, var(--color-surface), var(--color-elevated));
            border-radius: 12px;
            border: 1px solid var(--color-divider);
            transition: all 0.3s ease;
        }
        
        .setup-step::after {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: linear-gradient(180deg, var(--color-primary), var(--color-secondary));
            border-radius: 12px 0 0 12px;
        }

        .setup-step:hover {
            border-color: var(--color-primary);
            box-shadow: var(--shadow-md);
            transform: translateX(4px);
        }

        .setup-step::before {
            counter-increment: step-counter;
            content: counter(step-counter);
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 32px;
            height: 32px;
            background: linear-gradient(135deg, var(--color-primary), var(--color-secondary));
            color: var(--color-background);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            box-shadow: var(--shadow-sm);
            z-index: 1;
        }

        .step-title {
            font-weight: 600;
            color: var(--color-text-primary);
            margin-bottom: 8px;
        }

        .step-description {
            color: var(--color-text-secondary);
        }

        /* Code block */
        .code-block {
            background: var(--color-elevated);
            border: 1px solid var(--color-divider);
            border-radius: 8px;
            padding: 16px;
            margin-top: 12px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-x: auto;
            color: var(--color-text-primary);
        }

        /* Modal styles for node key generation */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .modal-content {
            background: var(--color-elevated);
            color: var(--color-text-primary);
            width: min(720px, 90%);
            border-radius: 16px;
            padding: 32px;
            box-shadow: var(--shadow-xl);
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--color-text-primary);
            margin: 0;
        }
        
        .modal-close {
            border: none;
            background: transparent;
            font-size: 24px;
            cursor: pointer;
            color: var(--color-text-secondary);
            padding: 4px;
            transition: color 0.2s ease;
        }
        
        .modal-close:hover {
            color: var(--color-text-primary);
        }
        
        .modal-body {
            color: var(--color-text-secondary);
        }
        
        .modal-button {
            background: var(--color-primary);
            color: var(--color-background);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 16px;
        }
        
        .modal-button:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .modal-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Theme toggle */
        .theme-toggle {
            position: fixed;
            bottom: 24px;
            right: 24px;
            width: 56px;
            height: 56px;
            border-radius: 50%;
            background: var(--color-primary);
            color: var(--color-background);
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            box-shadow: var(--shadow-lg);
            transition: all 0.3s ease;
            z-index: 100;
        }
        
        .theme-toggle:hover {
            transform: scale(1.1);
            box-shadow: var(--shadow-xl);
        }
    </style>
</head>
<body>
    <div id="header-container"></div>

    <!-- Requirements Section -->
    <div class="feature-section" style="padding-top: 40px;">
        <div class="section-container">
            <div class="section-header">
                <h2 class="section-title" data-i18n="systemRequirements">System Requirements</h2>
                <p class="section-subtitle" data-i18n="systemRequirementsDesc">What you need to join the network</p>
            </div>
            <div class="requirements-grid">
                <div class="requirement-item">
                    <span class="requirement-icon">üñ•Ô∏è</span>
                    <div class="requirement-text">
                        <div class="requirement-label" data-i18n="gpu">GPU</div>
                        <div class="requirement-value">NVIDIA RTX 3060 or better</div>
                    </div>
                </div>
                <div class="requirement-item">
                    <span class="requirement-icon">üíæ</span>
                    <div class="requirement-text">
                        <div class="requirement-label" data-i18n="vram">VRAM</div>
                        <div class="requirement-value">12GB minimum, 24GB+ recommended</div>
                    </div>
                </div>
                <div class="requirement-item">
                    <span class="requirement-icon">üåê</span>
                    <div class="requirement-text">
                        <div class="requirement-label" data-i18n="internet">Internet</div>
                        <div class="requirement-value">100 Mbps+ stable connection</div>
                    </div>
                </div>
                <div class="requirement-item">
                    <span class="requirement-icon">üê≥</span>
                    <div class="requirement-text">
                        <div class="requirement-label" data-i18n="software">Software</div>
                        <div class="requirement-value">Docker & NVIDIA drivers</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Setup Guide Section -->
    <div class="feature-section alt-background">
        <div class="section-container">
            <div class="section-header">
                <h2 class="section-title" data-i18n="quickSetupGuide">Quick Setup Guide</h2>
                <p class="section-subtitle" data-i18n="quickSetupDesc">Join the network in 3 simple steps</p>
            </div>
            <div class="setup-steps">
                <div class="setup-step">
                    <div class="step-title" data-i18n="installPrerequisites">Install Prerequisites</div>
                    <div class="step-description" data-i18n="installPrereqDesc">
                        Ensure Docker and NVIDIA Container Toolkit are installed on your system.
                    </div>
                    <div class="code-block">
                        # Ubuntu/Debian<br>
                        sudo apt-get install docker.io nvidia-container-toolkit<br><br>
                        # Verify installation<br>
                        docker run --rm --gpus all nvidia/cuda:11.8.0-base-ubuntu22.04 nvidia-smi
                    </div>
                </div>
                <div class="setup-step">
                    <div class="step-title" data-i18n="generateNodeKey">Generate Your Node Key</div>
                    <div class="step-description" data-i18n="generateNodeKeyDesc">
                        Click the button below to generate a unique API key for your node. This key identifies your contributions.
                    </div>
                    <button class="cta-button cta-primary" style="margin-top: 16px;" onclick="openJoinModal()" data-i18n="generateNodeKeyBtn">
                        Generate Node Key
                    </button>
                </div>
                <div class="setup-step">
                    <div class="step-title" data-i18n="runYourNode">Run Your Node</div>
                    <div class="step-description" data-i18n="runYourNodeDesc">
                        Copy and run the Docker command with your generated key to start contributing.
                    </div>
                    <div class="code-block" id="dockerCommand" style="display: none;">
                        docker run --gpus all --rm -it \<br>
                        &nbsp;&nbsp;-e BLYAN_API_KEY=YOUR_KEY_HERE \<br>
                        &nbsp;&nbsp;-e MAIN_SERVER_URL=https://blyan.com/api \<br>
                        &nbsp;&nbsp;ghcr.io/blyan-network/expert-node:latest
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Rewards Section -->
    <div class="stats-section">
        <div class="section-container">
            <div class="section-header">
                <h2 class="section-title" data-i18n="earningPotential">Earning Potential</h2>
                <p class="section-subtitle" data-i18n="earningPotentialDesc">Estimated rewards based on GPU type</p>
            </div>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-number">~45 BLY</div>
                    <div class="stat-label">RTX 3060 12GB / day</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">~80 BLY</div>
                    <div class="stat-label">RTX 3080 / day</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">~120 BLY</div>
                    <div class="stat-label">RTX 4070 Ti / day</div>
                </div>
                <div class="stat-item">
                    <div class="stat-number">~200 BLY</div>
                    <div class="stat-label">RTX 4090 / day</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Join modal -->
    <div id="joinModal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" data-i18n="joinTheNetwork">Join the Network</h3>
                <button id="joinClose" class="modal-close" aria-label="Close modal">‚úñ</button>
            </div>
            <div id="joinBody" class="modal-body">
                <p data-i18n="joinModalDesc">We will create a node operator API key and show a one‚Äëline command to start a GPU node. CPU mode is not supported for LLMs.</p>
                <button id="provisionKeyBtn" class="modal-button" data-i18n="generateNodeKeyModal">Generate Node Key</button>
                <div id="provisionResult" style="display:none;">
                    <div class="code-block" id="commandBox"></div>
                    <p style="margin-top:12px; color: var(--color-text-secondary);">
                        <span data-i18n="copyRunCommand">1) Copy and run the command on a GPU machine (Docker required).</span><br/>
                        <span data-i18n="orSetEnvAndRun">2) Or set the key as env and run the Python node.</span>
                    </p>
                    <pre id="altInstructions" class="code-block"></pre>
                </div>
            </div>
        </div>
    </div>

    <!-- Theme Toggle Button -->
    <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
        <span id="themeIcon">üåô</span>
    </button>

    <script src="config.js"></script>
    <script src="api-auth.js"></script>
    <script src="common-header.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Initialize theme
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
            
            // Create header
            document.getElementById('header-container').innerHTML = createAIBlockHeader('contribute');
            
            // Theme toggle functionality
            document.getElementById('themeToggle').addEventListener('click', () => {
                const currentTheme = document.documentElement.getAttribute('data-theme');
                const newTheme = currentTheme === 'light' ? 'dark' : 'light';
                document.documentElement.setAttribute('data-theme', newTheme);
                localStorage.setItem('theme', newTheme);
                updateThemeIcon(newTheme);
            });

            // Wire Join button
            document.getElementById('joinClose').addEventListener('click', () => {
                document.getElementById('joinModal').style.display = 'none';
            });
            document.getElementById('provisionKeyBtn').addEventListener('click', provisionNodeKeyAndShow);
        });
        
        function updateThemeIcon(theme) {
            const icon = document.getElementById('themeIcon');
            icon.textContent = theme === 'light' ? 'üåô' : '‚òÄÔ∏è';
        }

        function openJoinModal() {
            document.getElementById('joinModal').style.display = 'flex';
        }
        
        async function provisionNodeKeyAndShow() {
            const bodyEl = document.getElementById('joinBody');
            const btn = document.getElementById('provisionKeyBtn');
            const box = document.getElementById('commandBox');
            const result = document.getElementById('provisionResult');
            const alt = document.getElementById('altInstructions');
            btn.disabled = true; 
            btn.textContent = t('provisioning') || 'Provisioning‚Ä¶';
            try {
                // Request node_operator API key using fetch directly (don't need auth for registration)
                const resp = await fetch(`/auth/v2/register`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ name: `web-node-${Date.now()}`, key_type: 'node_operator' })
                });
                if (!resp.ok) {
                    const err = await resp.text();
                    throw new Error(err);
                }
                const data = await resp.json();
                const apiKey = data.api_key;
                // Store using the API auth manager for better management
                if (apiAuth && apiAuth.storeCredentials) {
                    apiAuth.storeCredentials(apiKey, { 
                        role: 'node_operator',
                        keyId: data.key_id,
                        expiresAt: data.expires_at,
                        metadata: { source: 'manual_generation' }
                    });
                }

                const dockerCmd = `docker run --gpus all --rm -it \\\n  -e BLYAN_API_KEY=${apiKey} \\\n  -e MAIN_SERVER_URL=${location.origin}/api \\\n  ghcr.io/blyan-network/expert-node:latest`;
                box.textContent = dockerCmd;

                const altText = `# Or Python (requires clone of repo)\nexport BLYAN_API_KEY=${apiKey}\nexport MAIN_SERVER_URL=${location.origin}/api\npython runpod_node.py`;
                alt.textContent = altText;

                result.style.display = 'block';
                btn.style.display = 'none';
            } catch (e) {
                bodyEl.insertAdjacentHTML('beforeend', `<div style="color:#b91c1c; margin-top:10px;">${t('failedToProvisionKey') || 'Failed to provision key'}: ${e.message}</div>`);
            } finally {
                btn.disabled = false; 
                btn.textContent = t('generateNodeKeyModal') || 'Generate Node Key';
            }
        }
    </script>
</body>
</html>